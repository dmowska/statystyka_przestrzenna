<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>9&nbsp; Miary autokorelacji danych obszarowych – Statystyka przestrzenna</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./13_pola.html" rel="next">
<link href="./11_poligony_sasiedztwo.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-c852b7e71cc1c09f55f367b2512aabbd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10_poligony.html">DANE OBSZAROWE</a></li><li class="breadcrumb-item"><a href="./12_poligony_autokorelacja.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Miary autokorelacji danych obszarowych</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Statystyka przestrzenna</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">O skrypcie</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./01_wstep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">WSTĘP</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_wprowadzenie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Wprowadzenie</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_zastosowanie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Zastosowania statystyki przestrzennej</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_daneprzestrzenne.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Dane przestrzenne w R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_eksploracja.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Eksploracyjna analiza danych przestrzennych</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./06_punkty.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DANE PUNKTOWE</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_punkty_centrograficzne.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Statystyki centrograficzne</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_punkty_odleglosc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Metody oparte na odległości</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_punkty_intensywnosc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Metody oparte na analizie intensywności</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./10_poligony.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DANE OBSZAROWE</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_poligony_sasiedztwo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Określanie sąsiedztwa danych obszarowych</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_poligony_autokorelacja.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Miary autokorelacji danych obszarowych</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./13_pola.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DANE POWIERZCHNIOWE CIĄGŁE PRZESTRZENNIE</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_pola_interpolacja.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Metody interpolacji</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_pola_modelowanie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Geostatystyka: Analiza i modelowanie autokorelacji przestrzennej</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_pola_estymacja.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Geostatystyczne metody estymacji</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_pola_ocena.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Ocena jakości estymacji</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">ZADANIA</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18_zadania_samodzielne.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Zadania samodzielne</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_projekt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Projekt</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_projekt_geostatystyka.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Projekt 2: Geostatytyka</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#autokorelacja-przestrzenna-danych-obszarowych" id="toc-autokorelacja-przestrzenna-danych-obszarowych" class="nav-link active" data-scroll-target="#autokorelacja-przestrzenna-danych-obszarowych"><span class="header-section-number">9.1</span> Autokorelacja przestrzenna danych obszarowych</a></li>
  <li><a href="#miary-autokorelacji-przestrzennej" id="toc-miary-autokorelacji-przestrzennej" class="nav-link" data-scroll-target="#miary-autokorelacji-przestrzennej"><span class="header-section-number">9.2</span> Miary autokorelacji przestrzennej</a>
  <ul class="collapse">
  <li><a href="#miary-globalne" id="toc-miary-globalne" class="nav-link" data-scroll-target="#miary-globalne"><span class="header-section-number">9.2.1</span> Miary globalne</a></li>
  <li><a href="#miary-lokalne" id="toc-miary-lokalne" class="nav-link" data-scroll-target="#miary-lokalne"><span class="header-section-number">9.2.2</span> Miary lokalne</a></li>
  </ul></li>
  <li><a href="#miary-autokorelacji-przestrzennej-w-r" id="toc-miary-autokorelacji-przestrzennej-w-r" class="nav-link" data-scroll-target="#miary-autokorelacji-przestrzennej-w-r"><span class="header-section-number">9.3</span> Miary autokorelacji przestrzennej w R</a>
  <ul class="collapse">
  <li><a href="#pakiet-spdep" id="toc-pakiet-spdep" class="nav-link" data-scroll-target="#pakiet-spdep"><span class="header-section-number">9.3.1</span> Pakiet <code>spdep</code></a></li>
  </ul></li>
  <li><a href="#przykład-stopa-bezrobocia-w-polsce-w-2023-roku" id="toc-przykład-stopa-bezrobocia-w-polsce-w-2023-roku" class="nav-link" data-scroll-target="#przykład-stopa-bezrobocia-w-polsce-w-2023-roku"><span class="header-section-number">9.4</span> Przykład: Stopa bezrobocia w Polsce w 2023 roku</a>
  <ul class="collapse">
  <li><a href="#dane" id="toc-dane" class="nav-link" data-scroll-target="#dane"><span class="header-section-number">9.4.1</span> Dane</a></li>
  <li><a href="#cel-analizy" id="toc-cel-analizy" class="nav-link" data-scroll-target="#cel-analizy"><span class="header-section-number">9.4.2</span> Cel analizy</a></li>
  <li><a href="#określanie-sąsiedztwa-danych-poligonowych" id="toc-określanie-sąsiedztwa-danych-poligonowych" class="nav-link" data-scroll-target="#określanie-sąsiedztwa-danych-poligonowych"><span class="header-section-number">9.4.3</span> Określanie sąsiedztwa danych poligonowych</a></li>
  <li><a href="#globalne-miary-autokorelacji-przestrzennej" id="toc-globalne-miary-autokorelacji-przestrzennej" class="nav-link" data-scroll-target="#globalne-miary-autokorelacji-przestrzennej"><span class="header-section-number">9.4.4</span> Globalne miary autokorelacji przestrzennej</a></li>
  <li><a href="#lokalne-miary-autokorelacji-przestrzennej" id="toc-lokalne-miary-autokorelacji-przestrzennej" class="nav-link" data-scroll-target="#lokalne-miary-autokorelacji-przestrzennej"><span class="header-section-number">9.4.5</span> Lokalne miary autokorelacji przestrzennej</a></li>
  </ul></li>
  <li><a href="#przykład-2-stopa-bezrobocia-w-polsce-w-2004-roku" id="toc-przykład-2-stopa-bezrobocia-w-polsce-w-2004-roku" class="nav-link" data-scroll-target="#przykład-2-stopa-bezrobocia-w-polsce-w-2004-roku"><span class="header-section-number">9.5</span> Przykład 2: Stopa bezrobocia w Polsce w 2004 roku</a>
  <ul class="collapse">
  <li><a href="#dane-1" id="toc-dane-1" class="nav-link" data-scroll-target="#dane-1"><span class="header-section-number">9.5.1</span> Dane</a></li>
  <li><a href="#miary-autokorelacji-przestrzennej-1" id="toc-miary-autokorelacji-przestrzennej-1" class="nav-link" data-scroll-target="#miary-autokorelacji-przestrzennej-1"><span class="header-section-number">9.5.2</span> Miary autokorelacji przestrzennej</a></li>
  <li><a href="#wizualizacja-wyników" id="toc-wizualizacja-wyników" class="nav-link" data-scroll-target="#wizualizacja-wyników"><span class="header-section-number">9.5.3</span> Wizualizacja wyników</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10_poligony.html">DANE OBSZAROWE</a></li><li class="breadcrumb-item"><a href="./12_poligony_autokorelacja.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Miary autokorelacji danych obszarowych</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Miary autokorelacji danych obszarowych</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!--    W4, U3  Wykład, Ćwiczenia w salach komputerowych-->
<section id="autokorelacja-przestrzenna-danych-obszarowych" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="autokorelacja-przestrzenna-danych-obszarowych"><span class="header-section-number">9.1</span> Autokorelacja przestrzenna danych obszarowych</h2>
<p>Autokorelacja przestrzenna (<em>spatial autocorrelation</em>) określa pewną zależność, która może być obserowana jako zgrupowania (klastry) podobnych wartości lub systematyczny wzorzec przestrzenny (<em>spatial pattern</em>).</p>
<p><img src="figs/autokorelacja.png" class="img-fluid"></p>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 81%">
</colgroup>
<tbody>
<tr class="odd">
<td rowspan="2">Losowość przestrzenna :=================================================================================================: wartości obserwowane w danym obszarze nie zależą od wartości obserwowanych w sąsiednich obszarach</td>
<td rowspan="2">Dodatnia autokorelacja przestrzenna data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAbElEQVR4Xs2RQQrAMAgEfZgf7W9LAguybljJpR3wEse5JOL3ZObDb4x1loDhHbBOFU6i2Ddnw2KNiXcdAXygJlwE8OFVBHDgKrLgSInN4WMe9iXiqIVsTMjH7z/GhNTEibOxQswcYIWYOR/zAjBJfiXh3jZ6AAAAAElFTkSuQmCC | Ujemna autokorelacja przestrzenna :=================================================================================================================:+:===============================================================================:+ obserwuje się podobne wartości w sąsiadujących obszarach (wysokie wartości otoczone wysokimi, lub niskie niskimi) | wartości sąsiednie różnią się od siebie (np. niskie wartości otoczone wysokimi) |</td>
</tr>
<tr class="even">
</tr>
</tbody>
</table>
</section>
<section id="miary-autokorelacji-przestrzennej" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="miary-autokorelacji-przestrzennej"><span class="header-section-number">9.2</span> Miary autokorelacji przestrzennej</h2>
<p>Celem analiz jest <strong>wyszukanie obszarów podobnych do siebie lub obszarów różniących się od sąsiednich.</strong> <strong><em>Losowość przestrzenna</em></strong> oznacza brak istnienia wzorca w przestrzeni. Przy testowaniu istnienia autokorelacji przestrzennej <strong>losowość przestrzenna jest przyjmowana jako hipoteza zerowa</strong>. W ramach analiz chcemy <strong>odrzucić</strong> hipotezę o występowaniu losowości przestrzennej (Odrzucenie hipotezy zerowej oznacza, że w danych istnieje jakiś wzorzec). Do testowania istnienia autokorelacji przestrzennej stosuje się różne <strong>miary autokorelacji przestrzennej</strong>.</p>
<section id="miary-globalne" class="level3" data-number="9.2.1">
<h3 data-number="9.2.1" class="anchored" data-anchor-id="miary-globalne"><span class="header-section-number">9.2.1</span> Miary globalne</h3>
<ul>
<li>jednoliczbowy wskaźnik autokorelacji przestrzennej lub ogólnego podobieństwa regionów</li>
<li>informuje o tym, że wartości nie są w przestrzeni rozmieszczone losowo -&gt; tj. istnieją przesłanki, że podobne wartości grupują się w przestrzeni</li>
<li>miary globalne <strong>nie informują</strong> nas gdzie zlokalizowane są zgrupowania podobnych wartości</li>
<li>statystyki globalne: I Morana, C Geary’ego, G Getisa &amp; Orda</li>
</ul>
</section>
<section id="miary-lokalne" class="level3" data-number="9.2.2">
<h3 data-number="9.2.2" class="anchored" data-anchor-id="miary-lokalne"><span class="header-section-number">9.2.2</span> Miary lokalne</h3>
<ul>
<li>obliczane dla każdego regionu;</li>
<li>pozwalaja odpowiedzieć na pytanie: czy dany region jest otoczony regionami o wysokich lub niskich wartościach? czy dany region jest podobny/różny wzgledem regionow sąsiednich?</li>
<li>statystyki lokalne: Lokalne I Morana, Lokalne C Geary’ego, Lokalne G Getisa &amp; Orda</li>
</ul>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 74%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th>Statystyka przestrzenna</th>
<th>Interpretacja</th>
<th>Komenda w R</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td><strong>MIARY GLOBALNE</strong></td>
<td></td>
</tr>
<tr class="even">
<td>Moran <span class="math inline">\(I\)</span></td>
<td><p><span class="math inline">\(I &gt; 0\)</span> - dodatnia autokorelacja przestrzenna</p>
<p><span class="math inline">\(I &lt; 0\)</span> - ujemna autokorelacja przestrzenna</p>
<p><span class="math inline">\(I = 0\)</span> - brak autokorelacji</p></td>
<td><em>moran()<br>
moran.test()<br>
moran.mc()<br>
moran.plot()</em></td>
</tr>
<tr class="odd">
<td>Geary <span class="math inline">\(C\)</span></td>
<td><p><span class="math inline">\(0-1\)</span> - dodatnia autokorelacja przestrzenna</p>
<p><span class="math inline">\(1-2\)</span> - ujemna autokorelacja przestrzenna</p>
<p><span class="math inline">\(1\)</span> - brak autokorelacji</p></td>
<td><em>geary()<br>
geary.test()<br>
geary.mc()</em></td>
</tr>
<tr class="even">
<td>Getis &amp; Ord <span class="math inline">\(G\)</span></td>
<td>testuje <span class="math inline">\(H_0\)</span> o braku autokorelacji przestrzennej przeciwko <span class="math inline">\(H_A\)</span> o dodatniej autokorelacji przestrzennej. Nie mierzy ujemnej autokorelacji przestrzennej.</td>
<td><em>globalG.test()</em></td>
</tr>
<tr class="odd">
<td></td>
<td><strong>MIARY LOKALNE</strong></td>
<td></td>
</tr>
<tr class="even">
<td>Local Moran <span class="math inline">\(I_{i}\)</span></td>
<td><p><span class="math inline">\(I_{i} &gt; 0\)</span> - grupowanie podobnych wartości (wyższych lub niższych od średniej)</p>
<p><span class="math inline">\(I_{i} &lt; 0\)</span> - połączenie różnych wartości (np. wysokie wartości otoczone niskimi wartościami lub niskie wartości otoczone wysokimi wartościami)</p></td>
<td><em>local.moran()</em></td>
</tr>
<tr class="odd">
<td>Local Geary <span class="math inline">\(C_{i}\)</span></td>
<td><p><span class="math inline">\(C_i &lt; 0\)</span> - niskie wartości wskazują na dodatnią autokorelację przestrzenną (podobieństwo regionu <span class="math inline">\(i\)</span> z sąsiadami)</p>
<p><span class="math inline">\(C_i &gt; 0\)</span> - wysokie wartości wskazują na ujemną autokorelację przestrzenną, tj. region nie jest podobny do sąsiadów</p>
<p><span class="math inline">\(C_i = 0\)</span> - brak autokorelacji przestrzennej</p></td>
<td><em>localC(), localC_perm()</em></td>
</tr>
<tr class="even">
<td>Local <span class="math inline">\(G_{i}\)</span></td>
<td><p><span class="math inline">\(G_{i} &gt; 0\)</span> - zgrupowanie regionów o relatywnie wysokich wartościach, klaster wysokich wartości (hot-spots)</p>
<p><span class="math inline">\(G_{i} &lt; 0\)</span> - zgrupowanie regionów o relatywnie niskich wartościach, klaster niskich wartości (cold-spots)</p></td>
<td><em>localG(), localG_perm()</em></td>
</tr>
</tbody>
</table>
<p><em>Źródło: Kopaczewska K. 2023. Przestrzenne metody ilościowe w R. (rozdział 4, str. 264-265), uzupełnione</em></p>
</section>
</section>
<section id="miary-autokorelacji-przestrzennej-w-r" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="miary-autokorelacji-przestrzennej-w-r"><span class="header-section-number">9.3</span> Miary autokorelacji przestrzennej w R</h2>
<p>Obliczenie miar autokorelacji przestrzennej w R wymaga wykonania dwóch kroków:</p>
<ol type="1">
<li>Utworzenie macierzy wag przestrzennych na podstawie wybranego sąsiedztwa i standaryzacji.</li>
<li>Obliczenie globalnych i lokalnych statystyk autokorelacji przestrzennych.</li>
</ol>
<section id="pakiet-spdep" class="level3" data-number="9.3.1">
<h3 data-number="9.3.1" class="anchored" data-anchor-id="pakiet-spdep"><span class="header-section-number">9.3.1</span> Pakiet <code>spdep</code></h3>
<p>Pakiet <code>spdep</code> dostarcza funkcji pozwalających na:</p>
<ul>
<li>tworzenie macierzy przestrzennych (<code>poly2nb</code>, <code>nb2listw</code>)</li>
<li>obliczanie miar autokorelacji przestrzennych (patrz tabela powyżej)</li>
</ul>
<!-- tests random data https://edzer.github.io/UseR2019/part2.html -->
<!-- prepare autocorrelated data as well -->
</section>
</section>
<section id="przykład-stopa-bezrobocia-w-polsce-w-2023-roku" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="przykład-stopa-bezrobocia-w-polsce-w-2023-roku"><span class="header-section-number">9.4</span> Przykład: Stopa bezrobocia w Polsce w 2023 roku</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="dane" class="level3" data-number="9.4.1">
<h3 data-number="9.4.1" class="anchored" data-anchor-id="dane"><span class="header-section-number">9.4.1</span> Dane</h3>
<p>W przykładzie zostaną wykorzystane dane dotyczące stopy bezrobocia w powiatach w Polsce w 2023 roku. Dane zostały pobrane z Banku Danych Lokalnych.</p>
<ul>
<li><p>Plik <code>bezrobocie_pl.csv</code> zawiera identyfikator powiatu, nazwę powiatu oraz dane dotyczące stopy bezrobocia dla lat 2004, 2010, 2021, 2023 (odpowiednio SB2004, SB2010, SB2021, SB2023).</p></li>
<li><p>Plik <code>powiaty_pl.gpkg</code> zawiera granice powiatów w Polsce.</p></li>
<li><p>Plik <code>wojewodztwa.gpkg</code> zawiera granice województw, jest używany wyłącznie przy wizualizacji wyników.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>bezrobocie <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"data/bezrobocie_pl.csv"</span>, <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">dec =</span> <span class="st">"."</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>powiaty_granica <span class="ot">=</span> <span class="fu">read_sf</span>(<span class="st">"data/powiaty_pl.gpkg"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>woj_granica <span class="ot">=</span> <span class="fu">read_sf</span>(<span class="st">"data/wojewodztwa.gpkg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Aby połączyć dane przestrzenne z informacją o stopie bezrobocia wykorzystane zostaną pola TERYT oraz Kod. Kolumna TERYT w pliku <code>powiaty_pl.gpkg</code> zawiera identyfikator powiatu w postaci 4 cyfr. Do pola TERYT trzeba dodać “000”, aby identyfikator powiatu w obu obiektach był taki sam. Do połączenia danych przestrzennych i nieprzestrzennych zostanie wykorzystana funkcja <code>merge()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>powiaty_granica<span class="sc">$</span>TERYT <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="fu">paste</span>(powiaty_granica<span class="sc">$</span>TERYT, <span class="st">"000"</span>, <span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>powiaty <span class="ot">=</span> <span class="fu">merge</span>(powiaty_granica[, <span class="st">"TERYT"</span>], bezrobocie, <span class="at">by.x =</span> <span class="st">"TERYT"</span>, <span class="at">by.y =</span> <span class="st">"Kod"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wizualizacja została wykonana z wykorzystaniem pakietu <code>tmap</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(powiaty) <span class="sc">+</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"SB2023"</span>, <span class="at">palette =</span> <span class="st">"YlOrBr"</span>) <span class="sc">+</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(woj_granica) <span class="sc">+</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="12_poligony_autokorelacja_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cel-analizy" class="level3" data-number="9.4.2">
<h3 data-number="9.4.2" class="anchored" data-anchor-id="cel-analizy"><span class="header-section-number">9.4.2</span> Cel analizy</h3>
<ul>
<li>analiza podobieństwa i różnic między obszarami/regionami</li>
<li>wyszukanie obszarów podobnych do siebie</li>
<li>znalezienie obszarów znacząco różnych od sąsiednich</li>
</ul>
</section>
<section id="określanie-sąsiedztwa-danych-poligonowych" class="level3" data-number="9.4.3">
<h3 data-number="9.4.3" class="anchored" data-anchor-id="określanie-sąsiedztwa-danych-poligonowych"><span class="header-section-number">9.4.3</span> Określanie sąsiedztwa danych poligonowych</h3>
<p>Obliczenie miar autokorelacji przestrzennej wymaga określenia, które powiaty ze sobą sąsiadują oraz zapisania tej informacji w postaci macierzy wag przestrzennych.</p>
<section id="utworzenie-macierzy-wag-przestrzennych" class="level4" data-number="9.4.3.1">
<h4 data-number="9.4.3.1" class="anchored" data-anchor-id="utworzenie-macierzy-wag-przestrzennych"><span class="header-section-number">9.4.3.1</span> Utworzenie macierzy wag przestrzennych</h4>
<p>Macierz sąsiedztwa została utworzona z wykorzystaniem kryterium wspólnej granicy stosując regułę <em>Queen</em>.</p>
<ul>
<li><p>Funkcja <code>poly2nb()</code> z pakieru <code>spdep</code> tworzy listę sąsiadów na podstawie regionów mających wspólne granice. Funkcja <code>poly2nb()</code> wymaga podania obiektu przestrzennego z granicami poligonów (w przykładzie obiekt <em>powiaty</em>) oraz określenia, czy stosowana będzie reguła <em>queen</em> (<em>queen = TRUE</em>), czy <em>rook</em> do określenia sąsiedztwa.</p></li>
<li><p>Funkcja <code>nb2listw()</code> z pakietu <code>spdep</code> tworzy macierz wag przestrzennych na podstawie macierzy sąsiedztwa. Funkcja <code>nb2listw()</code> wymaga podania obiektu zawierającego listę sąsiadów (obiekt będący wynikiem działania funkcji <code>poly2nb()</code> oraz typu macierzy wag (w przykładzie <em>style = “W”</em> oznacza, że zostanie utworzona macierz standaryzowana wierszami).</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#macierz sasiedztwa</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>nb_q <span class="ot">=</span> <span class="fu">poly2nb</span>(powiaty, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#macierz wag przestrzennych. </span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>lw <span class="ot">=</span> <span class="fu">nb2listw</span>(nb_q, <span class="at">style =</span> <span class="st">"W"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>lw</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 380 
Number of nonzero links: 2006 
Percentage nonzero weights: 1.389197 
Average number of links: 5.278947 

Weights style: W 
Weights constants summary:
    n     nn  S0       S1      S2
W 380 144400 380 169.7589 1632.39</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Na czym polega reguła QUEEN stosowana do określenia sąsiadów?</p>
</blockquote>
</section>
</section>
<section id="globalne-miary-autokorelacji-przestrzennej" class="level3" data-number="9.4.4">
<h3 data-number="9.4.4" class="anchored" data-anchor-id="globalne-miary-autokorelacji-przestrzennej"><span class="header-section-number">9.4.4</span> Globalne miary autokorelacji przestrzennej</h3>
<section id="globalny-test-i-morana" class="level4" data-number="9.4.4.1">
<h4 data-number="9.4.4.1" class="anchored" data-anchor-id="globalny-test-i-morana"><span class="header-section-number">9.4.4.1</span> Globalny test I Morana</h4>
<p>Statystyka globalna I Morana jest najstarszą miarą przestrzenną wprowadzoną przez Morana w 1950 roku. Wykorzystywana jest do testowania globalnej autokorelacji przestrzennej:</p>
<ul>
<li><span class="math inline">\(H_0\)</span> : brak autokorelacji przestrzennej</li>
<li><span class="math inline">\(H_1\)</span> : autokorelacja przestrzenna</li>
</ul>
<p>Statystyka I Morana przyjmuje wartości:</p>
<ul>
<li><span class="math inline">\(I = 0\)</span> - wartości obserwacji w odległości <span class="math inline">\(d\)</span> są rozłożone losowo</li>
<li><span class="math inline">\(I &gt; 0\)</span> - autokorelacja dodatnia (pozytywna); sąsiadujące wartości są podobne; wartości podobne stykają się częściej niż losowo</li>
<li><span class="math inline">\(I &lt; 0\)</span> - autokorelacja ujemna (negatywna); sąsiadujące wartości są różne</li>
</ul>
<p>Uwaga!: nawet wysokie wartości statystyki nie świadczą, że jest ona istotna statystycznie, dlatego poza policzeniem wartości statytyki należy wykonać test określający jej istotność statystyczną. Testowania istnienia autokorelacji przestrzennej może być wykonane wykorzystując dwa rodzaje testów:</p>
<ul>
<li>tradycyjne podejście (<code>moran.test()</code>)</li>
<li>symulację z wykorzystaniem Monte Carlo (<code>moran.mc()</code>)</li>
</ul>
<p>W tradycyjnym podejściu do testowania należy podać nazwę zmiennej (w przykładzie <em>powiaty$SB2023</em>) oraz macierz wag przestrzennych (argument <em>listw</em>). Do obliczenia statystyki I Morana zaleca się stosowanie macierzy wag przestrzennych standaryzowanej wierszami.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(powiaty<span class="sc">$</span>SB2023, <span class="at">listw =</span> lw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  powiaty$SB2023  
weights: lw    

Moran I statistic standard deviate = 12.997, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.439401477      -0.002638522       0.001156697 </code></pre>
</div>
</div>
<p>W wyniku otrzymamy wartość statystyki Morana (Moran I statistics) oraz istotność statystyczną wyniku (p-value).</p>
<p>Stosowanie tradycyjnego podeścia do testowania istotności autokorelacji wymaga spełnienia wielu założeń. Dlatego częściej stosuje się podejście oparte o symulacji. W każdej symulacji wartości danych przypisano losowo do poligonów, wyliczana jest wartość statystyki, a następnie sprawdza się, czy obliczona wartość statystyki Morana na podstawie danych jest wśród wartości, których spodziewalibysmy się z losowego rozkładu.</p>
<p>Do wykonania testu z wykorzystaniem symulacji stosuje się funkcję <code>moran.mc()</code> z pakietu <code>spdep</code>. Funkcja ta wymaga podania nazwy zmiennej (w przykładzie <em>powiaty$SB2023</em>), macierzy wag przestrzennych (argument <em>listw</em>) oraz liczby symulacji (argument <em>nsim</em>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>moran_test <span class="ot">=</span> <span class="fu">moran.mc</span>(powiaty<span class="sc">$</span>SB2023, <span class="at">listw =</span> lw, <span class="at">nsim =</span> <span class="dv">99</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>moran_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  powiaty$SB2023 
weights: lw  
number of simulations + 1: 100 

statistic = 0.4394, observed rank = 100, p-value = 0.01
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>W wyniku otrzymamy wartość statystyki (<em>statistic</em>) oraz psedo p-value (p-value). Należy pamiętać, że w tym wypadku wartość pseudo p-value jest zależne od liczby symulacji. (gdybyśmy wykonali 999 symulacji, zamiast 99 pseudo p-value wyniesie 0.001). Niska wartość p-value nadal wskazuje na istotność statystyczną wyniku.</p>
<p>W przypadku stopy bezrobocia w powiatach wartość statystyki globalnej I Morana wyniosła 0,4394 co wskazuje na autokorelacja dodatnia (pozytywna), tj. istnieje przesłanka, że w danych istnieją zgrupowania powiatów o podobnych wartościach stopy bezrobocia.</p>
</section>
<section id="globalny-test-c-gearyego" class="level4" data-number="9.4.4.2">
<h4 data-number="9.4.4.2" class="anchored" data-anchor-id="globalny-test-c-gearyego"><span class="header-section-number">9.4.4.2</span> Globalny test C Geary’ego</h4>
<p>Miara C Geary’ego jest kolejną miarą globalną wykorzystywaną do testowania globalnej autokorelacji przestrzennej:</p>
<ul>
<li><span class="math inline">\(H_0\)</span> : brak autokorelacji przestrzennej</li>
<li><span class="math inline">\(H_1\)</span> : autokorelacja przestrzenna</li>
</ul>
<p>Statystyka C Geary’ego przyjmuje wartości w przedziale od 0 do 2.</p>
<ul>
<li>0-1: autokorelacja dodatnia (pozytywna); sąsiadujące wartości są podobne</li>
<li>1: brak autokorelacji przestrzennej; sąsiadujące wartości są rozłożone losowo</li>
<li>1-2: autokorelacja ujemna (negatywna); sąsiadujące wartości nie są podobne</li>
</ul>
<p>Tak jak w przypadku statystyki I Morana do testowania istotności można zastsować tradycyjne podejście (funkcja <code>geary.test()</code> z pakietu <code>spdep</code>) lub podejście oparte o symulacje (funkcja <code>geary.mc()</code> z pakietu <code>spdep</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geary.test</span>(powiaty<span class="sc">$</span>SB2023, <span class="at">listw =</span> lw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Geary C test under randomisation

data:  powiaty$SB2023 
weights: lw   

Geary C statistic standard deviate = 11.024, p-value &lt; 2.2e-16
alternative hypothesis: Expectation greater than statistic
sample estimates:
Geary C statistic       Expectation          Variance 
      0.541515148       1.000000000       0.001729799 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geary.mc</span>(powiaty<span class="sc">$</span>SB2023, <span class="at">listw =</span> lw, <span class="at">nsim =</span> <span class="dv">99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Geary C

data:  powiaty$SB2023 
weights: lw  
number of simulations + 1: 100 

statistic = 0.54152, observed rank = 1, p-value = 0.01
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>Wartość statystyki (0,54) wskazuje na istnienie autokorelacji dodatniej.</p>
</section>
<section id="globalny-test-g-getisa-orda" class="level4" data-number="9.4.4.3">
<h4 data-number="9.4.4.3" class="anchored" data-anchor-id="globalny-test-g-getisa-orda"><span class="header-section-number">9.4.4.3</span> Globalny test G Getisa &amp; Orda</h4>
<p>Testuje hipotezę zerową o braku autokorelacji przestrzennej przeciwko hipotezie alternatywnej o dodatniej autokorelacji przestrzennej. Miara ta nie mierzy autokorelacji ujemnej.</p>
<ul>
<li><span class="math inline">\(H_0\)</span> : brak autokorelacji przestrzennej</li>
<li><span class="math inline">\(H_1\)</span> : <strong>dodatnia</strong> autokorelacja przestrzenna</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#obliczenie wag binarnych</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>lb <span class="ot">=</span> <span class="fu">nb2listw</span>(nb_q, <span class="at">style =</span> <span class="st">"B"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#testowanie</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">globalG.test</span>(powiaty<span class="sc">$</span>SB2023, <span class="at">listw =</span> lb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Getis-Ord global G statistic

data:  powiaty$SB2023 
weights: lb   

standard deviate = 5.679, p-value = 6.774e-09
alternative hypothesis: greater
sample estimates:
Global G statistic        Expectation           Variance 
      1.582796e-02       1.392862e-02       1.118554e-07 </code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Jak zinterpretujesz wynik?</p>
</blockquote>
</section>
</section>
<section id="lokalne-miary-autokorelacji-przestrzennej" class="level3" data-number="9.4.5">
<h3 data-number="9.4.5" class="anchored" data-anchor-id="lokalne-miary-autokorelacji-przestrzennej"><span class="header-section-number">9.4.5</span> Lokalne miary autokorelacji przestrzennej</h3>
<section id="zależność-między-regionem-a-sąsiadami" class="level4" data-number="9.4.5.1">
<h4 data-number="9.4.5.1" class="anchored" data-anchor-id="zależność-między-regionem-a-sąsiadami"><span class="header-section-number">9.4.5.1</span> Zależność między regionem a sąsiadami</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 38%">
<col style="width: 29%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Wartości niskie w regionie <span class="math inline">\(i\)</span> (L)</th>
<th style="text-align: center;">Wartości wysokie w regionie <span class="math inline">\(i\)</span> (H)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Wartości wysokie w regionach sąsiednich (H)</strong></td>
<td style="text-align: center;"><strong>Kwadrat LH (Q2)</strong><br>
<em>Ujemna autokorelacja przestrzenna</em></td>
<td style="text-align: center;"><strong>Kwadrat HH (Q1)</strong><br>
<em>Dodatnia autokorelacja przestrzenna</em></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Wartości niskie w regionach sąsiednich (L)</strong></td>
<td style="text-align: center;"><strong>Kwadrat LL</strong> <strong>(Q3)</strong><br>
Dodatnia autokorelacja przestrzenna</td>
<td style="text-align: center;"><strong>Kwadrat HL (Q4)</strong><br>
Ujemna autokorelacja przetrzenna</td>
</tr>
</tbody>
</table>
</section>
<section id="wykres-rozrzutu-morana" class="level4" data-number="9.4.5.2">
<h4 data-number="9.4.5.2" class="anchored" data-anchor-id="wykres-rozrzutu-morana"><span class="header-section-number">9.4.5.2</span> Wykres rozrzutu Morana</h4>
<p>Wykres rozrzutu Morana pokazuje zależność między wartościami zmiennej (oś x) oraz wartościami zmiennej późnionej przestrzennie (oś y, <em>spatial lag</em>, tj. średnia wartość wyliczona na podstawie sąsiadów graniczących z regionem). Pionowa przerywana linia wyznacza wartość średnią dla analizowanej zmiennej, pozioma przerywana linia oznacza średnią wartość dla zmiennej opóźnionej przestrzennie. Linie te dzielą wykres na 4 części.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.plot</span>(powiaty<span class="sc">$</span>SB2023, <span class="at">listw =</span> lw, <span class="at">labels =</span> powiaty<span class="sc">$</span>Nazwa)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">3</span>, <span class="dv">15</span>, <span class="st">"Q2: LH"</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"steelblue1"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">22</span>, <span class="dv">15</span>, <span class="st">"Q1: HH"</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">22</span>, <span class="dv">2</span>, <span class="st">"Q4: HL"</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"lightcoral"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="st">"Q3: LL"</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="12_poligony_autokorelacja_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Kwarta 1 (Q1) wskazuje, że wartości relatywnie wysokie (wyższe od średniej) otoczone są przez relatywnie wysokie wartości sąsiadów, co wskazuje na istnienie autokorelacji dodatniej. Kwarta 3 (Q3) pokazuje, że wartości w regionie są niższe od średnich oraz są otoczone relatywnie niższymi wartościami sąsiadów (to też świadczy o autokorelacji dodatniej). Kwarta 2 (Q2) oraz kwarta 4 (Q4) przedstawiają ujemną autokorelacją przestrzenną. W przypadku kwarty 2 (Q2) relatywnie niskie wartości zmiennej (poniżej średniej) otoczone są przez relatywnie wysokie wartości dla sąsiadów. W kwarcie 4 relatywnie wysokie wartości w regionie (powyżej średniej) otoczone są przez relatywnie niskie wartości dla sąsiadów.</p>
<p>Wykres rozrzutu statystyki Morana można także wykonać dla wartości standaryzowanych. Wykres punktowy statystyki Morana wykonany w oparciu o standaryzowane wartości zmiennej oraz zmiennej opóźnionej przestrzennie (<em>spatial lag</em>) stanowi graficzną reprezentację globalnej Statystyki Morana. Nachylenie linii regresji jest tożsame z globalną statystyką Morana. Linie przerywane na wykresie wyznaczają średnią wartość obserwowanej zmiennej oraz średnią wartość zmiennej opóźnionej przestrzennie. Po standaryzacji średnie będą równe 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#standaryzacja warości zmiennej</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>powiaty<span class="sc">$</span>SB_scaled <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(powiaty<span class="sc">$</span>SB2023))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">#obliczenie wartości standaryzowanych dla zmiennej opóźnionej przestrzennie</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>powiaty<span class="sc">$</span>SB_scaled_lag <span class="ot">=</span> <span class="fu">lag.listw</span>(lw, powiaty<span class="sc">$</span>SB_scaled)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># typy zależnosci </span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>powiaty <span class="ot">=</span> powiaty <span class="sc">|&gt;</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mp_q =</span> <span class="fu">case_when</span>(</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    powiaty<span class="sc">$</span>SB_scaled <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> powiaty<span class="sc">$</span>SB_scaled_lag <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Q1: HH"</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    powiaty<span class="sc">$</span>SB_scaled <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> powiaty<span class="sc">$</span>SB_scaled_lag <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Q3: LL"</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    powiaty<span class="sc">$</span>SB_scaled <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> powiaty<span class="sc">$</span>SB_scaled_lag <span class="sc">&lt;=</span> <span class="dv">0</span>  <span class="sc">~</span> <span class="st">"Q4: HL"</span>,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    powiaty<span class="sc">$</span>SB_scaled<span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> powiaty<span class="sc">$</span>SB_scaled_lag <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Q2: LH"</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  )) <span class="co"># classify the cluster types</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">#wykres rozrzutu</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(powiaty, <span class="fu">aes</span>(<span class="at">x=</span>SB_scaled, <span class="at">y=</span>SB_scaled_lag)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col =</span> mp_q), <span class="at">shape=</span><span class="dv">20</span>, <span class="at">show.legend =</span> F, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Q1: HH"</span><span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Q2: LH"</span> <span class="ot">=</span> <span class="st">"steelblue1"</span>, <span class="st">"Q3: LL"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Q4: HL"</span> <span class="ot">=</span> <span class="st">"lightcoral"</span>)) <span class="sc">+</span> </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(powiaty<span class="sc">$</span>SB_scaled_lag), <span class="at">lty=</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fu">mean</span>(powiaty<span class="sc">$</span>SB_scaled), <span class="at">lty=</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">18</span>) <span class="sc">+</span> </span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">formula=</span>y <span class="sc">~</span> x, <span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span> </span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom=</span><span class="st">"text"</span>, <span class="at">x=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">y=</span><span class="sc">-</span><span class="fl">1.5</span>, <span class="at">label=</span><span class="st">"Q3: LL"</span>, <span class="at">color=</span><span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom=</span><span class="st">"text"</span>, <span class="at">x=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">y=</span><span class="dv">2</span>, <span class="at">label=</span><span class="st">"Q2: LH"</span>, <span class="at">color=</span><span class="st">"steelblue1"</span>, <span class="at">size =</span> <span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom=</span><span class="st">"text"</span>, <span class="at">x=</span><span class="dv">3</span>, <span class="at">y=</span><span class="sc">-</span><span class="fl">1.5</span>, <span class="at">label=</span><span class="st">"Q4: HL"</span>, <span class="at">color=</span><span class="st">"lightcoral"</span>, <span class="at">size =</span> <span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom=</span><span class="st">"text"</span>, <span class="at">x=</span><span class="dv">3</span>, <span class="at">y=</span><span class="dv">2</span>, <span class="at">label=</span><span class="st">"Q1: HH"</span>, <span class="at">color=</span><span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="12_poligony_autokorelacja_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="lokalny-test-morana-i_i" class="level4" data-number="9.4.5.3">
<h4 data-number="9.4.5.3" class="anchored" data-anchor-id="lokalny-test-morana-i_i"><span class="header-section-number">9.4.5.3</span> Lokalny test Morana <span class="math inline">\(I_{i}\)</span></h4>
<p>Statytyka lokalna Morana <span class="math inline">\(I\)</span> obliczana jest dla każdego regionu. Statystyka ta mierzy czy region jest otoczony przez regiony sąsiedzkie o podobnych czy różnych wartościach w stosusnku do losowego rozmieszczenia tych wartości w przestrzeni:</p>
<ul>
<li><span class="math inline">\(I_{i} &gt; 0\)</span> - grupowanie podobnych wartości (wyższych lub niższych od średniej)</li>
<li><span class="math inline">\(I_{i} &lt; 0\)</span> - połączenie różnych wartości (np. wysokie wartości otoczone niskimi wartościami lub niskie wartości otoczone wysokimi wartościami)</li>
</ul>
<p>Statytyka lokalna Morana <span class="math inline">\(I\)</span>umożliwia wykrycie znaczących grup identycznych wartości wokół określonej lokalizacji (klastrów).</p>
<p>W R do obliczenia lokalnej statystyki Morana wykorzystuje się funkcję <code>localmoran()</code> z pakietu <code>spdep</code>. Funkcja ta wymaga zdefiniowania wartości zmiennej oraz macierzy wag przestrzennych (argument <em>listw</em>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>locm <span class="ot">=</span> <span class="fu">localmoran</span>(powiaty<span class="sc">$</span>SB2023, <span class="at">listw =</span> lw)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(locm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Ii          E.Ii      Var.Ii        Z.Ii Pr(z != E(Ii))
1 -0.02618885 -3.278138e-03 0.174557285 -0.05483648      0.9562687
2 -0.14316746 -4.621114e-04 0.028866576 -0.83992908      0.4009482
3  0.01752931 -6.811164e-05 0.004256387  0.26972955      0.7873683
4 -0.66667478 -8.537739e-03 0.452226259 -0.97867488      0.3277406
5  0.19350355 -1.352469e-03 0.072156657  0.72539678      0.4682086
6  0.11137371 -3.325013e-04 0.024994379  0.70657154      0.4798328</code></pre>
</div>
</div>
<p>W wyniku otrzymamy wartość statystyki Morana dla każdego regionu (<em>Ii</em>) oraz wartość poziomu istotności statystyki wyliczonej dla każdego regionu (kolumna <em>Pr(z != E(Ii))</em>). Wartości poziomu istotności oraz statystyki możemy przypisać do obiektu <em>powiaty</em> co pozwoli nam na zwizualizowanie wyników.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>powiaty<span class="sc">$</span>I <span class="ot">=</span> locm[, <span class="dv">1</span>]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>powiaty<span class="sc">$</span>I_pvalue <span class="ot">=</span> locm[, <span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Poniższa mapa przedstawia rozkład wartości statystyki lokalnej I Morana, bez uwzględniania informacji o istotności statystycznej wyniku. Kolorem niebieskim zaznaczono powiaty dla których odnotowano wartości wskazujące na autokorelację ujemną, a kolorem czerwonym na autokorelację dodatnią.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(powiaty) <span class="sc">+</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">fill =</span> <span class="st">"I"</span>,  <span class="at">palette =</span> <span class="st">"-RdBu"</span>, <span class="at">midpoint =</span> <span class="dv">0</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="12_poligony_autokorelacja_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Na poniższej mapie kolorem zilustrowano wartości poziomu isotności wyliczonego dla każdego powiatu. Powiaty oznaczone kolorem szarym na mapie nie mają istotnych statystycznie wartości statystyki lokalnej I Morana.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(powiaty) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="at">fill =</span> <span class="st">"I_pvalue"</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="dv">1</span>), <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"orange"</span>, <span class="st">"yellow"</span>, <span class="st">"darkgrey"</span>), <span class="at">colorNA =</span> <span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="12_poligony_autokorelacja_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Statystyka lokalna I Morana umożliwia identyfikację klastrów wysokich lub niskich wartości. Do identyfikacji klastrów wykorzystuje się wyłącznie <strong>istotne statystycznie</strong> wartości statystyki I Morana. Powiaty zostaną sklasyfikowane na 4 grupy: - wysokie wartości otoczone wysokimi wartościami - niskie wartości otoczone niskimi wartościami - wysokie wartości otoczone niskimi wartościami - niskie wartości otoczone wysokimi wartościami.</p>
<p>Do podziału na 4 grupy wykorzystuje się wykres rozrzutu Morana.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#standaryzacja wartości zmiennej SB2023</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>powiaty<span class="sc">$</span>SB_scaled <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(powiaty<span class="sc">$</span>SB2023))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#obliczenie wartości standaryzowanych dla zmiennej opóźnionej przestrzennie</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>powiaty<span class="sc">$</span>SB_scaled_lag <span class="ot">=</span> <span class="fu">lag.listw</span>(lw, powiaty<span class="sc">$</span>SB_scaled)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">#klasyfikacja na 4 grupy biorąc pod uwagę kwartę wykresu rozrzutu oraz informację czy statystyka jest istotna statystycznie</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>powiaty <span class="ot">=</span> powiaty <span class="sc">|&gt;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mcluster_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    powiaty<span class="sc">$</span>SB_scaled <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> powiaty<span class="sc">$</span>SB_scaled_lag <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> locm[, <span class="dv">5</span>] <span class="sc">&lt;=</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"High-High"</span>,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    powiaty<span class="sc">$</span>SB_scaled <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> powiaty<span class="sc">$</span>SB_scaled_lag <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> locm[, <span class="dv">5</span>] <span class="sc">&lt;=</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"Low-Low"</span>,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    powiaty<span class="sc">$</span>SB_scaled <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> powiaty<span class="sc">$</span>SB_scaled_lag <span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> locm[, <span class="dv">5</span>] <span class="sc">&lt;=</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"High-Low"</span>,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    powiaty<span class="sc">$</span>SB_scaled<span class="sc">&lt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> powiaty<span class="sc">$</span>SB_scaled_lag <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> locm[, <span class="dv">5</span>] <span class="sc">&lt;=</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"Low-High"</span>,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    locm[, <span class="dv">5</span>] <span class="sc">&gt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"Not Significant"</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  )) <span class="co"># classify the cluster types</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>cluster_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"High-High"</span><span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"High-Low"</span> <span class="ot">=</span> <span class="st">"lightcoral"</span>, <span class="st">"Low-High"</span> <span class="ot">=</span> <span class="st">"steelblue1"</span>, <span class="st">"Low-Low"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Not Significant"</span> <span class="ot">=</span> <span class="st">"lightgrey"</span> )</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>MyPalette <span class="ot">=</span> cluster_colors[<span class="fu">names</span>(cluster_colors) <span class="sc">%in%</span> <span class="fu">unique</span>(powiaty<span class="sc">$</span>mcluster_type)]</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(powiaty) <span class="sc">+</span> </span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"mcluster_type"</span>, <span class="at">palette =</span> MyPalette, <span class="at">colorNA =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(woj_granica) <span class="sc">+</span> </span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="12_poligony_autokorelacja_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Powyższą klasyfikację można także uzyskać stosując funkcję <code>hotspot()</code> z pakietu <code>spdep</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">localmoran</span>(powiaty<span class="sc">$</span>SB2023, <span class="at">listw =</span> lw) <span class="sc">|&gt;</span>  <span class="fu">hotspot</span>(<span class="at">Prname=</span><span class="st">"Pr(z != E(Ii))"</span>, <span class="at">cutoff=</span><span class="fl">0.05</span>, <span class="at">p.adjust=</span><span class="st">"none"</span>) <span class="ot">-&gt;</span> powiaty<span class="sc">$</span>localI</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(powiaty<span class="sc">$</span>localI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  Low-Low  High-Low  Low-High High-High 
       33         1         6        43 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>cluster_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"High-High"</span><span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"High-Low"</span> <span class="ot">=</span> <span class="st">"lightcoral"</span>, <span class="st">"Low-High"</span> <span class="ot">=</span> <span class="st">"steelblue1"</span>, <span class="st">"Low-Low"</span> <span class="ot">=</span> <span class="st">"blue"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>MyPalette <span class="ot">=</span> cluster_colors[<span class="fu">names</span>(cluster_colors) <span class="sc">%in%</span> <span class="fu">unique</span>(powiaty<span class="sc">$</span>localI)]</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(powiaty) <span class="sc">+</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"localI"</span>, <span class="at">palette =</span> MyPalette, <span class="at">colorNA =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(woj_granica) <span class="sc">+</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="12_poligony_autokorelacja_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="lokalna-statystyka-c-gearyego" class="level4" data-number="9.4.5.4">
<h4 data-number="9.4.5.4" class="anchored" data-anchor-id="lokalna-statystyka-c-gearyego"><span class="header-section-number">9.4.5.4</span> Lokalna statystyka C Geary’ego</h4>
<p>Lokalna statystyka C Geary’ego pokazuje średnie różnice między obiektem a sąsiadami co pomaga znależć wartośc odstające. Niskie wartości lokalnego Geary’ego wskazują na dodatnią autokorelację przestrzenną, a duże na ujemną autokorelację przestrzenną.</p>
<ul>
<li>0: brak autokorelacji</li>
<li><span class="math inline">\(C_{i} &lt; 0\)</span> - niskie wartości wskazują na dodatnią autokorelację przestrzenną, tj. podobieństwo regionu <span class="math inline">\(i\)</span> z sąsiednimi</li>
<li><span class="math inline">\(C_{i} &gt; 0\)</span> - wysokie wartości wskazują na ujemną autokorelację przestrzenną, tj. region nie ma podobnych wartości do sąsiadów</li>
</ul>
<p>W R lokalną statystykę C Geary’ego oblicza się używając funkcji <code>localC_perm()</code> z pakietu <code>spdep</code>, który wymaga zdefiniowania zmiennej uwzględnianej w analizie oraz macierzy wag przestrzennych (argument <em>listw</em>). Funkcja <code>hotspot()</code> z pakietu <code>spdep</code> zwraca wektor z przypisanymi kategoriami klastrów dla określonego poziomu isotności. Kategorie te można przypisac do obiektu przestrzennego powiaty oraz zwizualizować.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">localC_perm</span>(powiaty<span class="sc">$</span>SB2023, <span class="at">listw =</span> lw, <span class="at">nsim =</span> <span class="dv">99</span>) <span class="sc">|&gt;</span>  <span class="fu">hotspot</span>(<span class="at">Prname=</span><span class="st">"Pr(z != E(Ci)) Sim"</span>, <span class="at">cutoff=</span><span class="fl">0.05</span>, <span class="at">p.adjust=</span><span class="st">"none"</span>) <span class="ot">-&gt;</span> powiaty<span class="sc">$</span>localC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(powiaty<span class="sc">$</span>localC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
High-High   Low-Low  Negative 
       28        49         1 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>cluster_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"High-High"</span><span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Low-Low"</span> <span class="ot">=</span> <span class="st">"blue"</span>,  <span class="st">"Other Positive"</span> <span class="ot">=</span> <span class="st">"lightcoral"</span>, <span class="st">"Negative"</span> <span class="ot">=</span> <span class="st">"steelblue1"</span>, <span class="st">"Insignificant"</span> <span class="ot">=</span> <span class="st">"lightgrey"</span> )</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>MyPalette <span class="ot">=</span> cluster_colors[<span class="fu">names</span>(cluster_colors) <span class="sc">%in%</span> <span class="fu">unique</span>(powiaty<span class="sc">$</span>localC)]</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(powiaty) <span class="sc">+</span> </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"localC"</span>, <span class="at">palette =</span> MyPalette, <span class="at">colorNA =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(woj_granica) <span class="sc">+</span> </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="12_poligony_autokorelacja_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="lokalna-statystyka-g-getisa-orda" class="level4" data-number="9.4.5.5">
<h4 data-number="9.4.5.5" class="anchored" data-anchor-id="lokalna-statystyka-g-getisa-orda"><span class="header-section-number">9.4.5.5</span> Lokalna statystyka G Getisa &amp; Orda</h4>
<p>Wskaźnik do identyfikacji lokalnych zależności przestrzennych (koncentracji przestrzennych), które nie pojawiają się w analizie globalnej:</p>
<ul>
<li><span class="math inline">\(G_i &gt; 0\)</span> - zgrupowanie regionów o wysokich wartościach (region <span class="math inline">\(i\)</span> oraz regiony sąsiednie mają wysokie wartości) - tzw. klastr wysokich wartości (<em>hot-spots</em>)</li>
<li><span class="math inline">\(G_i &lt; 0\)</span> - zgrupowanie regionow o niskich wartościach (region <span class="math inline">\(i\)</span> jest otoczony przez podobne mu regiony o niskich wartościach) - tzw. <em>cold-spots</em></li>
</ul>
<p>Jako wysokie wartości uznaje się wartości wyższe od średniej, a jako niskie wartości uznaje się wartości niższe od średniej.</p>
<p>Lokalna statystyka G Getisa &amp; Orda <strong>nie mierzy autokorelacji ujemnej.</strong> <!-- - G will not show negative spatial autocorrelation --></p>
<!-- - It should only be calculated for ratio scale data, e.g., crime rates, birth rates -->
<p>W R lokalną statystykę G Getisa &amp; Orda oblicza się używając funkcji <code>localG_perm()</code> z pakietu <code>spdep</code>, który wymaga zdefiniowania zmiennej uwzględnianej w analizie oraz macierzy wag przestrzennych (argument <em>listw</em>). Funkcja <code>hotspot()</code> z pakietu <code>spdep</code> zwraca wektor z przypisanymi kategoriami klastrów dla określonego poziomu isotności. Kategorie te można przypisac do obiektu przestrzennego powiaty oraz zwizualizować.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>localG <span class="ot">=</span> <span class="fu">localG_perm</span>(powiaty<span class="sc">$</span>SB2023, <span class="at">listw =</span> lw, <span class="at">nsim =</span> <span class="dv">99</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>localG <span class="sc">|&gt;</span>  <span class="fu">hotspot</span>(<span class="at">Prname=</span><span class="st">"Pr(z != E(Gi)) Sim"</span>, <span class="at">cutoff=</span><span class="fl">0.05</span>, <span class="at">p.adjust=</span><span class="st">"none"</span>) <span class="ot">-&gt;</span> powiaty<span class="sc">$</span>localG</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(powiaty<span class="sc">$</span>localG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Low High 
  41   31 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>cluster_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Low"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"High"</span><span class="ot">=</span> <span class="st">"red"</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>MyPalette <span class="ot">=</span> cluster_colors[<span class="fu">names</span>(cluster_colors) <span class="sc">%in%</span> <span class="fu">unique</span>(powiaty<span class="sc">$</span>localG)]</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(powiaty) <span class="sc">+</span> </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"localG"</span>, <span class="at">palette =</span> MyPalette, <span class="at">colorNA =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(woj_granica) <span class="sc">+</span> </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="12_poligony_autokorelacja_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="przykład-2-stopa-bezrobocia-w-polsce-w-2004-roku" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="przykład-2-stopa-bezrobocia-w-polsce-w-2004-roku"><span class="header-section-number">9.5</span> Przykład 2: Stopa bezrobocia w Polsce w 2004 roku</h2>
<section id="dane-1" class="level3" data-number="9.5.1">
<h3 data-number="9.5.1" class="anchored" data-anchor-id="dane-1"><span class="header-section-number">9.5.1</span> Dane</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>bezrobocie <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"data/bezrobocie_pl.csv"</span>, <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">dec =</span> <span class="st">"."</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>powiaty_granica <span class="ot">=</span> <span class="fu">read_sf</span>(<span class="st">"data/powiaty_pl.gpkg"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>woj_granica <span class="ot">=</span> <span class="fu">read_sf</span>(<span class="st">"data/wojewodztwa.gpkg"</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>powiaty_granica<span class="sc">$</span>TERYT <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="fu">paste</span>(powiaty_granica<span class="sc">$</span>TERYT, <span class="st">"000"</span>, <span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>powiaty <span class="ot">=</span> <span class="fu">merge</span>(powiaty_granica[, <span class="st">"TERYT"</span>], bezrobocie, <span class="at">by.x =</span> <span class="st">"TERYT"</span>, <span class="at">by.y =</span> <span class="st">"Kod"</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>powiaty<span class="sc">$</span>SB2004[<span class="fu">is.na</span>(powiaty<span class="sc">$</span>SB2004)]<span class="ot">&lt;-</span><span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(powiaty) <span class="sc">+</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"SB2004"</span>, <span class="at">palette =</span> <span class="st">"YlOrBr"</span>) <span class="sc">+</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(woj_granica) <span class="sc">+</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="12_poligony_autokorelacja_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="miary-autokorelacji-przestrzennej-1" class="level3" data-number="9.5.2">
<h3 data-number="9.5.2" class="anchored" data-anchor-id="miary-autokorelacji-przestrzennej-1"><span class="header-section-number">9.5.2</span> Miary autokorelacji przestrzennej</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">#macierz sasiedztwa</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>nb_q <span class="ot">=</span> <span class="fu">poly2nb</span>(powiaty, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#macierz wag przestrzennych. </span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>lw <span class="ot">=</span> <span class="fu">nb2listw</span>(nb_q, <span class="at">style =</span> <span class="st">"W"</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">#globalna statystyka Morana </span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>moran_test <span class="ot">=</span> <span class="fu">moran.mc</span>(powiaty<span class="sc">$</span>SB2004, <span class="at">listw =</span> lw, <span class="at">nsim =</span> <span class="dv">99</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co"># globalna statystyka C Geary'ego </span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>geary_test <span class="ot">=</span> <span class="fu">geary.mc</span>(powiaty<span class="sc">$</span>SB2004, <span class="at">listw =</span> lw, <span class="at">nsim =</span> <span class="dv">99</span>)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co">#globalna statystyka Getisa i Orda </span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>g_test <span class="ot">=</span> <span class="fu">globalG.test</span>(powiaty<span class="sc">$</span>SB2004, <span class="at">listw =</span> lw)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co">#lokalna statystyka Morana - klastry wartości </span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="fu">localmoran</span>(powiaty<span class="sc">$</span>SB2004, <span class="at">listw =</span> lw) <span class="sc">|&gt;</span>  <span class="fu">hotspot</span>(<span class="at">Prname=</span><span class="st">"Pr(z != E(Ii))"</span>, <span class="at">cutoff=</span><span class="fl">0.05</span>, <span class="at">p.adjust=</span><span class="st">"none"</span>) <span class="ot">-&gt;</span> powiaty<span class="sc">$</span>localI</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="co"># lokalna statystyka Geary'ego </span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="fu">localC_perm</span>(powiaty<span class="sc">$</span>SB2004, <span class="at">listw =</span> lw, <span class="at">nsim =</span> <span class="dv">99</span>) <span class="sc">|&gt;</span>  <span class="fu">hotspot</span>(<span class="at">Prname=</span><span class="st">"Pr(z != E(Ci)) Sim"</span>, <span class="at">cutoff=</span><span class="fl">0.05</span>, <span class="at">p.adjust=</span><span class="st">"none"</span>) <span class="ot">-&gt;</span> powiaty<span class="sc">$</span>localC</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="co"># lokalna statstyka Getisa i Orda</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="fu">localG_perm</span>(powiaty<span class="sc">$</span>SB2004, <span class="at">listw =</span> lw, <span class="at">nsim =</span> <span class="dv">99</span>)<span class="sc">|&gt;</span>  <span class="fu">hotspot</span>(<span class="at">Prname=</span><span class="st">"Pr(z != E(Gi)) Sim"</span>, <span class="at">cutoff=</span><span class="fl">0.05</span>, <span class="at">p.adjust=</span><span class="st">"none"</span>) <span class="ot">-&gt;</span> powiaty<span class="sc">$</span>localG</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="wizualizacja-wyników" class="level3" data-number="9.5.3">
<h3 data-number="9.5.3" class="anchored" data-anchor-id="wizualizacja-wyników"><span class="header-section-number">9.5.3</span> Wizualizacja wyników</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">#wizualizacja wyników</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co">#local I</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>cluster_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"High-High"</span><span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"High-Low"</span> <span class="ot">=</span> <span class="st">"lightcoral"</span>, <span class="st">"Low-High"</span> <span class="ot">=</span> <span class="st">"steelblue1"</span>, <span class="st">"Low-Low"</span> <span class="ot">=</span> <span class="st">"blue"</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>MyPalette <span class="ot">=</span> cluster_colors[<span class="fu">names</span>(cluster_colors) <span class="sc">%in%</span> <span class="fu">unique</span>(powiaty<span class="sc">$</span>localI)]</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>tm_i <span class="ot">=</span> <span class="fu">tm_shape</span>(powiaty) <span class="sc">+</span> </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"localI"</span>, <span class="at">palette =</span> MyPalette, <span class="at">colorNA =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(woj_granica) <span class="sc">+</span> </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co">#local C</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>cluster_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"High-High"</span><span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Low-Low"</span> <span class="ot">=</span> <span class="st">"blue"</span>,  <span class="st">"Other Positive"</span> <span class="ot">=</span> <span class="st">"lightcoral"</span>, <span class="st">"Negative"</span> <span class="ot">=</span> <span class="st">"steelblue1"</span>)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>MyPalette <span class="ot">=</span> cluster_colors[<span class="fu">names</span>(cluster_colors) <span class="sc">%in%</span> <span class="fu">unique</span>(powiaty<span class="sc">$</span>localC)]</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>tm_c <span class="ot">=</span> <span class="fu">tm_shape</span>(powiaty) <span class="sc">+</span> </span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"localC"</span>, <span class="at">palette =</span> MyPalette, <span class="at">colorNA =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(woj_granica) <span class="sc">+</span> </span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="co">#local G</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>cluster_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Low"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"High"</span><span class="ot">=</span> <span class="st">"red"</span>)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>MyPalette <span class="ot">=</span> cluster_colors[<span class="fu">names</span>(cluster_colors) <span class="sc">%in%</span> <span class="fu">unique</span>(powiaty<span class="sc">$</span>localG)]</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>tm_g  <span class="ot">=</span> <span class="fu">tm_shape</span>(powiaty) <span class="sc">+</span> </span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"localG"</span>, <span class="at">palette =</span> MyPalette, <span class="at">colorNA =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(woj_granica) <span class="sc">+</span> </span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(tm_i, tm_c, tm_g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="12_poligony_autokorelacja_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./11_poligony_sasiedztwo.html" class="pagination-link" aria-label="Określanie sąsiedztwa danych obszarowych">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Określanie sąsiedztwa danych obszarowych</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./13_pola.html" class="pagination-link" aria-label="DANE POWIERZCHNIOWE CIĄGŁE PRZESTRZENNIE">
        <span class="nav-page-text">DANE POWIERZCHNIOWE CIĄGŁE PRZESTRZENNIE</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>